# 🤖 多智能体协作查询优化说明

## 🎯 优化目标

针对用户反馈"智能协作查询中各智能体的查询结果不够多"的问题，我们对多智能体系统进行了全面优化。

## 📈 优化内容

### 1. 增加默认结果数量限制

**之前的设置：**
- 关系查询：`limit: 3`
- 实体查询：`limit: 5`
- 通用查询：`limit: 10`

**优化后的设置：**
- 关系查询：`searchLimit: 15`（搜索更多候选实体）
- 实体查询：`limit: 15`
- 通用查询：`limit: 20`
- 直接搜索：`limit: 20`

### 2. 增强关系分析深度

**之前：** 只分析找到的第一个实体的关系

**优化后：** 
- 分析前 5 个最相关实体的关系
- 提供每个实体的详细关系分析
- 合并所有分析结果，提供更全面的视图

### 3. 可配置的查询参数

用户现在可以通过 `context` 参数自定义：

```json
{
  "query": "你的查询问题",
  "context": {
    "limit": 20,           // 通用搜索结果数量
    "searchLimit": 15,     // 实体搜索结果数量  
    "maxDepth": 3,         // 关系分析最大深度
    "includeIndirect": true // 是否包含间接关系
  }
}
```

### 4. 更丰富的元数据

**优化后的响应包含：**
- `analyzed_entities_count`: 分析的实体数量
- `total_found_entities`: 找到的实体总数
- `{实体名}_relationships`: 每个实体的关系数量
- 详细的分析过程和结果

## 🔧 使用方式

### API 调用示例

```bash
curl -X POST http://localhost:8080/api/v1/graph/agents/collaborative-query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "分析张机与王叔和的关系",
    "context": {
      "limit": 25,
      "searchLimit": 20,
      "maxDepth": 4,
      "includeIndirect": true
    }
  }'
```

### 测试客户端

打开 `test-api.html`，在多智能体协作部分现在可以：
- 调整结果数量限制
- 设置搜索限制
- 配置最大深度
- 选择是否包含间接关系

## 📊 性能对比

| 查询类型 | 优化前结果数 | 优化后结果数 | 提升比例 |
|---------|-------------|-------------|----------|
| 关系查询 | 1个实体分析 | 5个实体分析 | 500% |
| 实体搜索 | 3-5个结果 | 15个结果 | 300-500% |
| 通用查询 | 10个结果 | 20个结果 | 200% |

## 🎯 优化效果

### 1. 更全面的关系分析
- 不再只分析单个实体
- 提供多个相关实体的关系网络
- 发现更多潜在的连接

### 2. 更丰富的搜索结果
- 显著增加候选实体数量
- 提高找到相关实体的概率
- 减少"未找到相关实体"的情况

### 3. 更好的用户体验
- 可自定义查询参数
- 更详细的分析报告
- 更透明的处理过程

## 🔄 向后兼容性

- ✅ 所有现有的 API 调用仍然有效
- ✅ 不指定 context 参数时使用优化后的默认值
- ✅ 命令行演示程序同步优化
- ✅ 保持相同的响应格式

## 💡 使用建议

### 针对不同查询类型的推荐设置：

**复杂关系分析：**
```json
{
  "limit": 30,
  "searchLimit": 25,
  "maxDepth": 4,
  "includeIndirect": true
}
```

**快速实体查询：**
```json
{
  "limit": 15,
  "searchLimit": 10,
  "maxDepth": 2,
  "includeIndirect": false
}
```

**深度探索：**
```json
{
  "limit": 50,
  "searchLimit": 30,
  "maxDepth": 5,
  "includeIndirect": true
}
```

## 🚀 未来优化方向

1. **智能参数调整** - 根据查询类型自动优化参数
2. **结果排序优化** - 基于相关性和重要性排序
3. **缓存机制** - 缓存常见查询结果提高响应速度
4. **并行处理** - 进一步优化多智能体并行执行效率

现在多智能体协作查询能提供更丰富、更全面的结果了！🎉